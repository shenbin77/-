# 微信接口服务器配置指南
# WeChat Interface Server Setup Guide

## 🚀 第一步：启动Flask服务器

### 安装依赖
```bash
pip install flask
```

### 启动服务器
```bash
python wechat_server.py
```

服务器将在 `http://localhost:5000` 启动

## 🌐 第二步：内网穿透（获取公网URL）

由于微信服务器需要访问您的接口，您需要将本地服务暴露到公网。

### 方案1：使用ngrok（推荐）

1. **下载ngrok**：
   - 访问 https://ngrok.com/
   - 注册账号并下载ngrok

2. **启动ngrok**：
   ```bash
   ngrok http 5000
   ```

3. **获取公网URL**：
   ngrok会显示类似这样的URL：
   ```
   https://abc123.ngrok.io -> http://localhost:5000
   ```

### 方案2：使用花生壳

1. 下载花生壳客户端
2. 注册账号并配置内网穿透
3. 映射本地5000端口

### 方案3：使用frp

1. 搭建frp服务器或使用免费服务
2. 配置客户端连接
3. 映射本地5000端口

## ⚙️ 第三步：配置微信接口

### 1. 填写接口配置信息

在微信测试号管理页面：

- **URL**: `https://your-ngrok-url.ngrok.io/wechat`
  （替换为您的实际ngrok URL）
- **Token**: `StockAnalysisBot2024`

### 2. 点击"提交"验证

微信会向您的URL发送验证请求，如果配置正确会显示"配置成功"。

## 🧪 第四步：测试功能

### 基本测试
1. 在微信中给测试号发送消息："你好"
2. 应该收到帮助信息回复

### 功能测试
发送以下消息测试各项功能：

- **"帮助"** - 查看所有命令
- **"股票推荐"** - 获取推荐股票
- **"市场分析"** - 获取分析报告
- **"查询平安银行"** - 查询具体股票
- **"订阅"** - 开启推送服务

## 📊 系统功能特性

### ✅ 已实现功能：

1. **双向消息处理**
   - 接收用户消息
   - 智能回复处理
   - 命令识别解析

2. **股票查询服务**
   - 实时股票推荐
   - 市场分析报告
   - 个股信息查询

3. **订阅管理**
   - 开启/关闭推送
   - 个性化服务
   - 用户偏好记录

4. **智能交互**
   - 自然语言理解
   - 上下文识别
   - 帮助指导

### 🔄 消息流程：

```
用户发送消息 → 微信服务器 → 您的Flask服务器 → 处理逻辑 → 回复消息 → 微信服务器 → 用户收到回复
```

## 🛠️ 故障排除

### 如果验证失败：
1. 检查ngrok是否正常运行
2. 确认URL格式正确（包含/wechat）
3. 检查Token是否匹配
4. 查看Flask服务器日志

### 如果收不到回复：
1. 检查Flask服务器是否运行
2. 查看服务器日志输出
3. 确认消息格式正确
4. 检查网络连接

### 常见错误：
- **Token验证失败**：检查Token是否为`StockAnalysisBot2024`
- **URL不可访问**：确认ngrok正常运行
- **消息无回复**：检查Flask服务器日志

## 🎯 高级配置（可选）

### 1. 自定义菜单
可以在微信测试号后台配置自定义菜单，提供更好的用户体验。

### 2. 模板消息
配置模板消息ID，发送格式化的推送消息。

### 3. 网页授权
配置JS接口安全域名，支持网页授权登录。

## 🚀 部署到生产环境

### 使用云服务器：
1. 购买云服务器（阿里云、腾讯云等）
2. 部署Flask应用
3. 配置域名和SSL证书
4. 使用Nginx反向代理

### 使用Heroku：
1. 创建Heroku应用
2. 推送代码到Heroku
3. 配置环境变量
4. 获取应用URL

## 📱 用户使用指南

配置完成后，用户可以：

1. **发送"帮助"** 查看所有功能
2. **发送"股票推荐"** 获取AI推荐
3. **发送"查询[股票名]"** 查询具体股票
4. **发送"订阅"** 开启每日推送
5. **发送"市场分析"** 获取分析报告

## 🎉 完成！

现在您拥有了一个完整的双向交互股票分析系统：

✅ **自动推送** - 定时发送分析报告
✅ **实时查询** - 用户主动查询股票
✅ **智能交互** - 自然语言对话
✅ **订阅管理** - 个性化推送服务

您的AI股票分析助手现在可以与用户进行智能对话了！🤖✨
