# 资产负债表数据获取程序使用说明

## 程序概述

本目录包含两个用于获取股票资产负债表数据的Python程序：

1. `balance_sheet.py` - 批量获取所有股票的资产负债表数据
2. `balance_sheet_test.py` - 测试单个股票的资产负债表数据获取

## 功能特点

- **数据来源**: 使用Tushare Pro API获取资产负债表数据
- **数据范围**: 2020年1月1日至2025年4月30日
- **数据字段**: 包含完整的资产负债表字段（共147个字段）
- **数据存储**: 自动创建MySQL数据表并存储数据
- **错误处理**: 包含完善的异常处理机制
- **API限制**: 内置API调用频率控制

## 数据表结构

程序会自动创建 `stock_balance_sheet` 表，包含以下主要字段：

### 基本信息
- `ts_code`: 股票代码
- `ann_date`: 公告日期
- `f_ann_date`: 实际公告日期
- `end_date`: 报告期
- `report_type`: 报告类型
- `comp_type`: 公司类型

### 资产类科目

#### 流动资产
- `money_cap`: 货币资金
- `trad_asset`: 交易性金融资产
- `notes_receiv`: 应收票据
- `accounts_receiv`: 应收账款
- `oth_receiv`: 其他应收款
- `prepayment`: 预付款项
- `inventories`: 存货
- `total_cur_assets`: 流动资产合计

#### 非流动资产
- `lt_eqt_invest`: 长期股权投资
- `invest_real_estate`: 投资性房地产
- `fix_assets`: 固定资产
- `cip`: 在建工程
- `intan_assets`: 无形资产
- `goodwill`: 商誉
- `defer_tax_assets`: 递延所得税资产
- `total_nca`: 非流动资产合计

#### 资产总计
- `total_assets`: 资产总计

### 负债类科目

#### 流动负债
- `st_borr`: 短期借款
- `notes_payable`: 应付票据
- `acct_payable`: 应付账款
- `adv_receipts`: 预收款项
- `payroll_payable`: 应付职工薪酬
- `taxes_payable`: 应交税费
- `oth_payable`: 其他应付款
- `total_cur_liab`: 流动负债合计

#### 非流动负债
- `lt_borr`: 长期借款
- `bond_payable`: 应付债券
- `lt_payable`: 长期应付款
- `defer_tax_liab`: 递延所得税负债
- `total_ncl`: 非流动负债合计

#### 负债总计
- `total_liab`: 负债合计

### 所有者权益类科目
- `total_share`: 期末总股本
- `cap_rese`: 资本公积金
- `surplus_rese`: 盈余公积金
- `undistr_porfit`: 未分配利润
- `treasury_share`: 减:库存股
- `minority_int`: 少数股东权益
- `total_hldr_eqy_exc_min_int`: 股东权益合计(不含少数股东权益)
- `total_hldr_eqy_inc_min_int`: 股东权益合计(含少数股东权益)
- `total_liab_hldr_eqy`: 负债及股东权益总计

### 金融行业特有科目
- `cash_reser_cb`: 现金及存放中央银行款项
- `depos_in_oth_bfi`: 存放同业和其它金融机构款项
- `sett_rsrv`: 结算备付金
- `loanto_oth_bank_fi`: 拆出资金
- `pur_resale_fa`: 买入返售金融资产

### 保险行业特有科目
- `premium_receiv`: 应收保费
- `reinsur_receiv`: 应收分保账款
- `reser_une_prem`: 未到期责任准备金
- `reser_outstd_claims`: 未决赔款准备金
- `ph_invest`: 保户储金及投资款

## 使用方法

### 1. 测试程序（推荐先运行）

```bash
cd /Users/henrylin/PycharmProjects/stock/tushare_pl/local
python balance_sheet_test.py
```

这个程序会：
- 获取单个测试股票（300474.SZ）的资产负债表数据
- 显示数据预览和主要财务指标
- 计算流动比率、资产负债率等财务比率
- 验证API连接和数据格式

### 2. 批量获取程序

```bash
cd /Users/henrylin/PycharmProjects/stock/tushare_pl/local
python balance_sheet.py
```

这个程序会：
- 从数据库获取所有股票代码
- 批量调用Tushare API获取资产负债表数据
- 自动创建数据表并存储数据
- 显示处理进度和统计信息

## 程序特性

### API频率控制
- 单次调用间隔：0.2秒
- 批次间隔：3.3秒
- 批次大小：50只股票

### 错误处理
- 自动跳过无数据的股票
- 记录处理失败的股票数量
- 显示详细的错误信息

### 数据完整性
- 使用 `INSERT IGNORE` 避免重复数据
- 自动处理NaN值
- 保持数据类型一致性

## 财务分析应用

### 偿债能力分析
- **流动比率** = 流动资产 / 流动负债
- **速动比率** = (流动资产 - 存货) / 流动负债
- **资产负债率** = 总负债 / 总资产
- **权益乘数** = 总资产 / 股东权益

### 营运能力分析
- **应收账款周转率** = 营业收入 / 平均应收账款
- **存货周转率** = 营业成本 / 平均存货
- **总资产周转率** = 营业收入 / 平均总资产

### 资产结构分析
- **流动资产占比** = 流动资产 / 总资产
- **固定资产占比** = 固定资产 / 总资产
- **无形资产占比** = 无形资产 / 总资产

### 资本结构分析
- **股东权益比率** = 股东权益 / 总资产
- **长期负债比率** = 长期负债 / 总资产
- **资本化比率** = 长期负债 / (长期负债 + 股东权益)

## 注意事项

1. **API权限**: 确保Tushare API token有足够的权限访问资产负债表数据
2. **数据库连接**: 确保MySQL数据库连接正常
3. **存储空间**: 资产负债表数据量较大，确保有足够的存储空间
4. **运行时间**: 批量获取可能需要较长时间，建议在网络稳定时运行
5. **数据更新**: 建议定期运行以获取最新的财务数据
6. **行业差异**: 不同行业的资产负债表科目可能有所差异

## 数据应用场景

### 1. 基本面分析
- 分析公司资产质量和负债结构
- 评估公司偿债能力和财务风险
- 研究公司资本配置效率

### 2. 财务比率计算
- 计算各种偿债能力指标
- 分析营运能力和资产效率
- 评估资本结构合理性

### 3. 行业对比
- 同行业公司财务结构对比
- 行业平均水平分析
- 识别行业领先企业

### 4. 趋势分析
- 分析资产负债结构变化趋势
- 跟踪公司财务健康状况
- 预测未来发展方向

### 5. 量化策略
- 构建基于财务数据的选股策略
- 风险控制和组合优化
- 价值投资策略开发

## 故障排除

### 常见问题

1. **API调用失败**
   - 检查网络连接
   - 验证API token是否有效
   - 确认API调用频率是否超限

2. **数据库连接失败**
   - 检查数据库服务是否启动
   - 验证连接参数是否正确
   - 确认数据库权限是否足够

3. **数据插入失败**
   - 检查数据表是否存在
   - 验证数据格式是否正确
   - 确认字段长度是否足够

### 性能优化建议

1. **批量处理**: 合理设置批次大小
2. **索引优化**: 为常用查询字段添加索引
3. **数据压缩**: 考虑使用数据压缩减少存储空间
4. **定期清理**: 清理过期或无效数据

## 扩展功能

可以根据需要扩展以下功能：

1. **增量更新**: 只获取新增或更新的数据
2. **数据验证**: 添加资产负债表平衡性检查
3. **财务比率计算**: 自动计算常用财务比率
4. **数据可视化**: 添加资产负债结构图表
5. **异常检测**: 识别异常的财务数据
6. **报告生成**: 自动生成财务分析报告 